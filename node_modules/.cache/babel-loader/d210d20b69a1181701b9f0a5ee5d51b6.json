{"ast":null,"code":"var _jsxFileName = \"D:\\\\LienSon\\\\LienSon-FE\\\\src\\\\containers\\\\System\\\\Admin\\\\NewsRedux.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../store/actions\"; // import \"./NewsRedux.scss\";\n\nimport Lightbox from \"react-image-lightbox\";\nimport \"react-image-lightbox/style.css\";\nimport TableManageNews from \"./TableManageNews\";\nimport { CRUD_ACTIONS, CommonUtils } from \"../../../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass NewsRedux extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleOnChangeImage = async event => {\n      let data = event.target.files;\n      let file = data[0];\n\n      if (file) {\n        let base64 = await CommonUtils.getBase64(file);\n        let objectUrl = URL.createObjectURL(file);\n        this.setState({\n          previewImgUrl: objectUrl,\n          image: base64\n        });\n      }\n    };\n\n    this.openPreviewImage = () => {\n      if (!this.state.previewImgUrl) return;\n      this.setState({\n        isOpen: true\n      });\n    };\n\n    this.handleSaveNews = () => {\n      let isValid = this.checkValidateInput();\n      if (isValid === false) return;\n      let {\n        action\n      } = this.state;\n\n      if (action === CRUD_ACTIONS.CREATE) {\n        //fire redux create\n        this.props.createNewNews({\n          name: this.state.name,\n          image: this.state.image\n        });\n      }\n\n      if (action === CRUD_ACTIONS.EDIT) {\n        //fire redux edit\n        this.props.editNewsRedux({\n          id: this.state.newsEditId,\n          name: this.state.name,\n          image: this.state.image\n        });\n      }\n    };\n\n    this.checkValidateInput = () => {\n      let isValid = true;\n      let arrCheck = [\"name\"];\n\n      for (let i = 0; i < arrCheck.length; i++) {\n        if (!this.state[arrCheck[i]]) {\n          isValid = false;\n          alert(\"Thông tin không được để trống: \" + arrCheck[i]);\n          break;\n        }\n      }\n\n      return isValid;\n    };\n\n    this.onChangeInput = (event, id) => {\n      let copyState = { ...this.state\n      };\n      copyState[id] = event.target.value;\n      this.setState({ ...copyState\n      });\n    };\n\n    this.handleEditNewsFromParent = News => {\n      let imageBase64 = \"\";\n\n      if (News.image) {\n        imageBase64 = new Buffer.from(News.image, \"base64\").toString(\"binary\");\n      }\n\n      this.setState({\n        name: News.name,\n        image: imageBase64,\n        previewImgUrl: imageBase64,\n        action: CRUD_ACTIONS.EDIT,\n        newsEditId: News.id\n      });\n    };\n\n    this.state = {\n      previewImgUrl: \"\",\n      name: \"\",\n      image: \"\",\n      action: \"\",\n      newsEditId: \"\"\n    };\n  }\n\n  async componentDidMount() {}\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (prevProps.listNews !== this.props.listNews) {\n      this.setState({\n        name: \"\",\n        image: \"\",\n        action: CRUD_ACTIONS.CREATE,\n        previewImgUrl: \"\"\n      });\n    }\n  }\n\n  render() {\n    let {\n      name\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"News-redux-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: \"Qu\\u1EA3n l\\xFD tin t\\u1EE9c\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"body\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: \"Th\\xEAm tin t\\u1EE9c\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"T\\xEAn tin t\\u1EE9c: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 127,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                className: \"form-control\",\n                type: \"text\",\n                value: name,\n                onChange: event => {\n                  this.onChangeInput(event, \"name\");\n                } // disabled={this.state.action === CRUD_ACTIONS.EDIT ? true : false}\n\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 128,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"H\\xECnh \\u1EA3nh: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"preview-img-container\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  id: \"previewImg\",\n                  type: \"file\",\n                  hidden: true,\n                  onChange: event => this.handleOnChangeImage(event)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 142,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                  className: \"label-upload\",\n                  htmlFor: \"previewImg\",\n                  children: [\"T\\u1EA3i \\u1EA3nh\", /*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"fas fa-upload\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 149,\n                    columnNumber: 28\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 148,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"preview-img\",\n                  style: {\n                    backgroundImage: `url(${this.state.previewImgUrl})`\n                  },\n                  onClick: () => this.openPreviewImage()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 151,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 141,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12 my-3\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: this.state.action === CRUD_ACTIONS.EDIT ? \"btn btn-warning\" : \"btn btn-primary\",\n                onClick: () => this.handleSaveNews(),\n                children: this.state.action === CRUD_ACTIONS.EDIT ? \"Cập nhật\" : \"Lưu\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-12\",\n              children: /*#__PURE__*/_jsxDEV(TableManageNews, {\n                handleEditNewsFromParent: this.handleEditNewsFromParent,\n                action: this.state.action\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 175,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 174,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }, this), this.state.isOpen === true && /*#__PURE__*/_jsxDEV(Lightbox, {\n        mainSrc: this.state.previewImgUrl,\n        onCloseRequest: () => this.setState({\n          isOpen: false\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    listNews: state.news.news\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    createNewNews: data => dispatch(actions.createNewNews(data)),\n    fetchNewsRedux: () => dispatch(actions.fetchAllNewsStart()),\n    editNewsRedux: data => dispatch(actions.editNews(data)) // processLogout: () => dispatch(actions.processLogout()),\n\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(NewsRedux);","map":{"version":3,"sources":["D:/LienSon/LienSon-FE/src/containers/System/Admin/NewsRedux.js"],"names":["React","Component","connect","actions","Lightbox","TableManageNews","CRUD_ACTIONS","CommonUtils","NewsRedux","constructor","props","handleOnChangeImage","event","data","target","files","file","base64","getBase64","objectUrl","URL","createObjectURL","setState","previewImgUrl","image","openPreviewImage","state","isOpen","handleSaveNews","isValid","checkValidateInput","action","CREATE","createNewNews","name","EDIT","editNewsRedux","id","newsEditId","arrCheck","i","length","alert","onChangeInput","copyState","value","handleEditNewsFromParent","News","imageBase64","Buffer","from","toString","componentDidMount","componentDidUpdate","prevProps","prevState","snapshot","listNews","render","backgroundImage","mapStateToProps","news","mapDispatchToProps","dispatch","fetchNewsRedux","fetchAllNewsStart","editNews"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAO,KAAKC,OAAZ,MAAyB,wBAAzB,C,CACA;;AACA,OAAOC,QAAP,MAAqB,sBAArB;AACA,OAAO,gCAAP;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,SAASC,YAAT,EAAuBC,WAAvB,QAA0C,gBAA1C;;;AAEA,MAAMC,SAAN,SAAwBP,SAAxB,CAAkC;AAChCQ,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SA0BnBC,mBA1BmB,GA0BG,MAAOC,KAAP,IAAiB;AACrC,UAAIC,IAAI,GAAGD,KAAK,CAACE,MAAN,CAAaC,KAAxB;AACA,UAAIC,IAAI,GAAGH,IAAI,CAAC,CAAD,CAAf;;AACA,UAAIG,IAAJ,EAAU;AACR,YAAIC,MAAM,GAAG,MAAMV,WAAW,CAACW,SAAZ,CAAsBF,IAAtB,CAAnB;AACA,YAAIG,SAAS,GAAGC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAhB;AACA,aAAKM,QAAL,CAAc;AACZC,UAAAA,aAAa,EAAEJ,SADH;AAEZK,UAAAA,KAAK,EAAEP;AAFK,SAAd;AAID;AACF,KArCkB;;AAAA,SAuCnBQ,gBAvCmB,GAuCA,MAAM;AACvB,UAAI,CAAC,KAAKC,KAAL,CAAWH,aAAhB,EAA+B;AAC/B,WAAKD,QAAL,CAAc;AACZK,QAAAA,MAAM,EAAE;AADI,OAAd;AAGD,KA5CkB;;AAAA,SA8CnBC,cA9CmB,GA8CF,MAAM;AACrB,UAAIC,OAAO,GAAG,KAAKC,kBAAL,EAAd;AACA,UAAID,OAAO,KAAK,KAAhB,EAAuB;AAEvB,UAAI;AAAEE,QAAAA;AAAF,UAAa,KAAKL,KAAtB;;AACA,UAAIK,MAAM,KAAKzB,YAAY,CAAC0B,MAA5B,EAAoC;AAClC;AACA,aAAKtB,KAAL,CAAWuB,aAAX,CAAyB;AACvBC,UAAAA,IAAI,EAAE,KAAKR,KAAL,CAAWQ,IADM;AAEvBV,UAAAA,KAAK,EAAE,KAAKE,KAAL,CAAWF;AAFK,SAAzB;AAID;;AAED,UAAIO,MAAM,KAAKzB,YAAY,CAAC6B,IAA5B,EAAkC;AAChC;AACA,aAAKzB,KAAL,CAAW0B,aAAX,CAAyB;AACvBC,UAAAA,EAAE,EAAE,KAAKX,KAAL,CAAWY,UADQ;AAEvBJ,UAAAA,IAAI,EAAE,KAAKR,KAAL,CAAWQ,IAFM;AAGvBV,UAAAA,KAAK,EAAE,KAAKE,KAAL,CAAWF;AAHK,SAAzB;AAKD;AACF,KAnEkB;;AAAA,SAqEnBM,kBArEmB,GAqEE,MAAM;AACzB,UAAID,OAAO,GAAG,IAAd;AACA,UAAIU,QAAQ,GAAG,CAAC,MAAD,CAAf;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,QAAQ,CAACE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACxC,YAAI,CAAC,KAAKd,KAAL,CAAWa,QAAQ,CAACC,CAAD,CAAnB,CAAL,EAA8B;AAC5BX,UAAAA,OAAO,GAAG,KAAV;AACAa,UAAAA,KAAK,CAAC,oCAAoCH,QAAQ,CAACC,CAAD,CAA7C,CAAL;AACA;AACD;AACF;;AACD,aAAOX,OAAP;AACD,KAhFkB;;AAAA,SAkFnBc,aAlFmB,GAkFH,CAAC/B,KAAD,EAAQyB,EAAR,KAAe;AAC7B,UAAIO,SAAS,GAAG,EAAE,GAAG,KAAKlB;AAAV,OAAhB;AACAkB,MAAAA,SAAS,CAACP,EAAD,CAAT,GAAgBzB,KAAK,CAACE,MAAN,CAAa+B,KAA7B;AACA,WAAKvB,QAAL,CAAc,EACZ,GAAGsB;AADS,OAAd;AAGD,KAxFkB;;AAAA,SA0FnBE,wBA1FmB,GA0FSC,IAAD,IAAU;AACnC,UAAIC,WAAW,GAAG,EAAlB;;AACA,UAAID,IAAI,CAACvB,KAAT,EAAgB;AACdwB,QAAAA,WAAW,GAAG,IAAIC,MAAM,CAACC,IAAX,CAAgBH,IAAI,CAACvB,KAArB,EAA4B,QAA5B,EAAsC2B,QAAtC,CAA+C,QAA/C,CAAd;AACD;;AAED,WAAK7B,QAAL,CAAc;AACZY,QAAAA,IAAI,EAAEa,IAAI,CAACb,IADC;AAEZV,QAAAA,KAAK,EAAEwB,WAFK;AAGZzB,QAAAA,aAAa,EAAEyB,WAHH;AAIZjB,QAAAA,MAAM,EAAEzB,YAAY,CAAC6B,IAJT;AAKZG,QAAAA,UAAU,EAAES,IAAI,CAACV;AALL,OAAd;AAOD,KAvGkB;;AAEjB,SAAKX,KAAL,GAAa;AACXH,MAAAA,aAAa,EAAE,EADJ;AAGXW,MAAAA,IAAI,EAAE,EAHK;AAIXV,MAAAA,KAAK,EAAE,EAJI;AAMXO,MAAAA,MAAM,EAAE,EANG;AAOXO,MAAAA,UAAU,EAAE;AAPD,KAAb;AASD;;AAEsB,QAAjBc,iBAAiB,GAAG,CAAE;;AAE5BC,EAAAA,kBAAkB,CAACC,SAAD,EAAYC,SAAZ,EAAuBC,QAAvB,EAAiC;AACjD,QAAIF,SAAS,CAACG,QAAV,KAAuB,KAAK/C,KAAL,CAAW+C,QAAtC,EAAgD;AAC9C,WAAKnC,QAAL,CAAc;AACZY,QAAAA,IAAI,EAAE,EADM;AAEZV,QAAAA,KAAK,EAAE,EAFK;AAGZO,QAAAA,MAAM,EAAEzB,YAAY,CAAC0B,MAHT;AAIZT,QAAAA,aAAa,EAAE;AAJH,OAAd;AAMD;AACF;;AAiFDmC,EAAAA,MAAM,GAAG;AACP,QAAI;AAAExB,MAAAA;AAAF,QAAW,KAAKR,KAApB;AAEA,wBACE;AAAK,MAAA,SAAS,EAAC,sBAAf;AAAA,8BACE;AAAK,QAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAEE;AAAK,QAAA,SAAS,EAAC,MAAf;AAAA,+BACE;AAAK,UAAA,SAAS,EAAC,WAAf;AAAA,iCACE;AAAK,YAAA,SAAS,EAAC,KAAf;AAAA,oCACE;AAAK,cAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAK,cAAA,SAAS,EAAC,QAAf;AAAA,sCACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AACE,gBAAA,SAAS,EAAC,cADZ;AAEE,gBAAA,IAAI,EAAC,MAFP;AAGE,gBAAA,KAAK,EAAEQ,IAHT;AAIE,gBAAA,QAAQ,EAAGtB,KAAD,IAAW;AACnB,uBAAK+B,aAAL,CAAmB/B,KAAnB,EAA0B,MAA1B;AACD,iBANH,CAOE;;AAPF;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF,eAeE;AAAK,cAAA,SAAS,EAAC,OAAf;AAAA,sCACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAK,gBAAA,SAAS,EAAC,uBAAf;AAAA,wCACE;AACE,kBAAA,EAAE,EAAC,YADL;AAEE,kBAAA,IAAI,EAAC,MAFP;AAGE,kBAAA,MAAM,MAHR;AAIE,kBAAA,QAAQ,EAAGA,KAAD,IAAW,KAAKD,mBAAL,CAAyBC,KAAzB;AAJvB;AAAA;AAAA;AAAA;AAAA,wBADF,eAOE;AAAO,kBAAA,SAAS,EAAC,cAAjB;AAAgC,kBAAA,OAAO,EAAC,YAAxC;AAAA,+DACS;AAAG,oBAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,0BADT;AAAA;AAAA;AAAA;AAAA;AAAA,wBAPF,eAUE;AACE,kBAAA,SAAS,EAAC,aADZ;AAEE,kBAAA,KAAK,EAAE;AACL+C,oBAAAA,eAAe,EAAG,OAAM,KAAKjC,KAAL,CAAWH,aAAc;AAD5C,mBAFT;AAKE,kBAAA,OAAO,EAAE,MAAM,KAAKE,gBAAL;AALjB;AAAA;AAAA;AAAA;AAAA,wBAVF;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAfF,eAqCE;AAAK,cAAA,SAAS,EAAC,aAAf;AAAA,qCACE;AACE,gBAAA,SAAS,EACP,KAAKC,KAAL,CAAWK,MAAX,KAAsBzB,YAAY,CAAC6B,IAAnC,GACI,iBADJ,GAEI,iBAJR;AAME,gBAAA,OAAO,EAAE,MAAM,KAAKP,cAAL,EANjB;AAAA,0BAQG,KAAKF,KAAL,CAAWK,MAAX,KAAsBzB,YAAY,CAAC6B,IAAnC,GAA0C,UAA1C,GAAuD;AAR1D;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBArCF,eAkDE;AAAK,cAAA,SAAS,EAAC,QAAf;AAAA,qCACE,QAAC,eAAD;AACE,gBAAA,wBAAwB,EAAE,KAAKW,wBADjC;AAEE,gBAAA,MAAM,EAAE,KAAKpB,KAAL,CAAWK;AAFrB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBAlDF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cAFF,EAgEG,KAAKL,KAAL,CAAWC,MAAX,KAAsB,IAAtB,iBACC,QAAC,QAAD;AACE,QAAA,OAAO,EAAE,KAAKD,KAAL,CAAWH,aADtB;AAEE,QAAA,cAAc,EAAE,MAAM,KAAKD,QAAL,CAAc;AAAEK,UAAAA,MAAM,EAAE;AAAV,SAAd;AAFxB;AAAA;AAAA;AAAA;AAAA,cAjEJ;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAyED;;AAtL+B;;AAyLlC,MAAMiC,eAAe,GAAIlC,KAAD,IAAW;AACjC,SAAO;AACL+B,IAAAA,QAAQ,EAAE/B,KAAK,CAACmC,IAAN,CAAWA;AADhB,GAAP;AAGD,CAJD;;AAMA,MAAMC,kBAAkB,GAAIC,QAAD,IAAc;AACvC,SAAO;AACL9B,IAAAA,aAAa,EAAGpB,IAAD,IAAUkD,QAAQ,CAAC5D,OAAO,CAAC8B,aAAR,CAAsBpB,IAAtB,CAAD,CAD5B;AAELmD,IAAAA,cAAc,EAAE,MAAMD,QAAQ,CAAC5D,OAAO,CAAC8D,iBAAR,EAAD,CAFzB;AAGL7B,IAAAA,aAAa,EAAGvB,IAAD,IAAUkD,QAAQ,CAAC5D,OAAO,CAAC+D,QAAR,CAAiBrD,IAAjB,CAAD,CAH5B,CAIL;;AAJK,GAAP;AAMD,CAPD;;AASA,eAAeX,OAAO,CAAC0D,eAAD,EAAkBE,kBAAlB,CAAP,CAA6CtD,SAA7C,CAAf","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from \"../../../store/actions\";\r\n// import \"./NewsRedux.scss\";\r\nimport Lightbox from \"react-image-lightbox\";\r\nimport \"react-image-lightbox/style.css\";\r\nimport TableManageNews from \"./TableManageNews\";\r\nimport { CRUD_ACTIONS, CommonUtils } from \"../../../utils\";\r\n\r\nclass NewsRedux extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      previewImgUrl: \"\",\r\n\r\n      name: \"\",\r\n      image: \"\",\r\n\r\n      action: \"\",\r\n      newsEditId: \"\",\r\n    };\r\n  }\r\n\r\n  async componentDidMount() {}\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    if (prevProps.listNews !== this.props.listNews) {\r\n      this.setState({\r\n        name: \"\",\r\n        image: \"\",\r\n        action: CRUD_ACTIONS.CREATE,\r\n        previewImgUrl: \"\",\r\n      });\r\n    }\r\n  }\r\n\r\n  handleOnChangeImage = async (event) => {\r\n    let data = event.target.files;\r\n    let file = data[0];\r\n    if (file) {\r\n      let base64 = await CommonUtils.getBase64(file);\r\n      let objectUrl = URL.createObjectURL(file);\r\n      this.setState({\r\n        previewImgUrl: objectUrl,\r\n        image: base64,\r\n      });\r\n    }\r\n  };\r\n\r\n  openPreviewImage = () => {\r\n    if (!this.state.previewImgUrl) return;\r\n    this.setState({\r\n      isOpen: true,\r\n    });\r\n  };\r\n\r\n  handleSaveNews = () => {\r\n    let isValid = this.checkValidateInput();\r\n    if (isValid === false) return;\r\n\r\n    let { action } = this.state;\r\n    if (action === CRUD_ACTIONS.CREATE) {\r\n      //fire redux create\r\n      this.props.createNewNews({\r\n        name: this.state.name,\r\n        image: this.state.image,\r\n      });\r\n    }\r\n\r\n    if (action === CRUD_ACTIONS.EDIT) {\r\n      //fire redux edit\r\n      this.props.editNewsRedux({\r\n        id: this.state.newsEditId,\r\n        name: this.state.name,\r\n        image: this.state.image,\r\n      });\r\n    }\r\n  };\r\n\r\n  checkValidateInput = () => {\r\n    let isValid = true;\r\n    let arrCheck = [\"name\"];\r\n    for (let i = 0; i < arrCheck.length; i++) {\r\n      if (!this.state[arrCheck[i]]) {\r\n        isValid = false;\r\n        alert(\"Thông tin không được để trống: \" + arrCheck[i]);\r\n        break;\r\n      }\r\n    }\r\n    return isValid;\r\n  };\r\n\r\n  onChangeInput = (event, id) => {\r\n    let copyState = { ...this.state };\r\n    copyState[id] = event.target.value;\r\n    this.setState({\r\n      ...copyState,\r\n    });\r\n  };\r\n\r\n  handleEditNewsFromParent = (News) => {\r\n    let imageBase64 = \"\";\r\n    if (News.image) {\r\n      imageBase64 = new Buffer.from(News.image, \"base64\").toString(\"binary\");\r\n    }\r\n\r\n    this.setState({\r\n      name: News.name,\r\n      image: imageBase64,\r\n      previewImgUrl: imageBase64,\r\n      action: CRUD_ACTIONS.EDIT,\r\n      newsEditId: News.id,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    let { name } = this.state;\r\n\r\n    return (\r\n      <div className=\"News-redux-container\">\r\n        <div className=\"title\">Quản lý tin tức</div>\r\n        <div className=\"body\">\r\n          <div className=\"container\">\r\n            <div className=\"row\">\r\n              <div className=\"col-12\">Thêm tin tức</div>\r\n              <div className=\"col-12\">\r\n                <label>Tên tin tức: </label>\r\n                <input\r\n                  className=\"form-control\"\r\n                  type=\"text\"\r\n                  value={name}\r\n                  onChange={(event) => {\r\n                    this.onChangeInput(event, \"name\");\r\n                  }}\r\n                  // disabled={this.state.action === CRUD_ACTIONS.EDIT ? true : false}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"col-3\">\r\n                <label>Hình ảnh: </label>\r\n                <div className=\"preview-img-container\">\r\n                  <input\r\n                    id=\"previewImg\"\r\n                    type=\"file\"\r\n                    hidden\r\n                    onChange={(event) => this.handleOnChangeImage(event)}\r\n                  />\r\n                  <label className=\"label-upload\" htmlFor=\"previewImg\">\r\n                    Tải ảnh<i className=\"fas fa-upload\"></i>\r\n                  </label>\r\n                  <div\r\n                    className=\"preview-img\"\r\n                    style={{\r\n                      backgroundImage: `url(${this.state.previewImgUrl})`,\r\n                    }}\r\n                    onClick={() => this.openPreviewImage()}\r\n                  ></div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"col-12 my-3\">\r\n                <button\r\n                  className={\r\n                    this.state.action === CRUD_ACTIONS.EDIT\r\n                      ? \"btn btn-warning\"\r\n                      : \"btn btn-primary\"\r\n                  }\r\n                  onClick={() => this.handleSaveNews()}\r\n                >\r\n                  {this.state.action === CRUD_ACTIONS.EDIT ? \"Cập nhật\" : \"Lưu\"}\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"col-12\">\r\n                <TableManageNews\r\n                  handleEditNewsFromParent={this.handleEditNewsFromParent}\r\n                  action={this.state.action}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {this.state.isOpen === true && (\r\n          <Lightbox\r\n            mainSrc={this.state.previewImgUrl}\r\n            onCloseRequest={() => this.setState({ isOpen: false })}\r\n          />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    listNews: state.news.news,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    createNewNews: (data) => dispatch(actions.createNewNews(data)),\r\n    fetchNewsRedux: () => dispatch(actions.fetchAllNewsStart()),\r\n    editNewsRedux: (data) => dispatch(actions.editNews(data)),\r\n    // processLogout: () => dispatch(actions.processLogout()),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(NewsRedux);\r\n"]},"metadata":{},"sourceType":"module"}